name: Run module tests

on:
  workflow_call:
    inputs:
      test-dir:
        description: "Path to the tests directory"
        type: string
        required: false
        default: "tests"
      verbose:
        description: "Show detailed build logs"
        type: boolean
        required: false
      always-update-west:
        description: "Run west update on cache hits"
        type: boolean
        required: false

jobs:
  run-tests:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v4
      - uses: urob/zmk-actions/setup-zephyr@main

      - name: Set up ZMK workspace
        uses: urob/zmk-actions/setup-zmk@main
        id: setup-zmk
        with:
          config: ${{ inputs.test-dir }}
          always-update-west: ${{ inputs.always-update-west }}

      - name: Test
        id: test
        uses: urob/zmk-actions/test@v2
        with:
          verbose: ${{ inputs.verbose }}
          test-dir: ${{ inputs.test-dir }}
          workspace: ${{ steps.setup-zmk.outputs.workspace }}
          zmk-src-dir: ${{ steps.setup-zmk.outputs.zmk-src-dir }}
